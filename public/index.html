<!DOCTYPE html>
<html>
<!--
  Created by Kyle Permuy, 9/8/2017
-->
<head>
  <title>Server Unit Tests</title>
<style>

</style>
</head>

<body>
  <p id="serverMsg">Connecting to server...</p>

  <hr />

  <p id="mixName">Not connected to a mix.</p>
  <p id="userList">Users Connected: ...</p>
  <input type="text" id="setMixName" name="setMixName" placeholder="HelloWorld">
  <input type="text" id="setMixPass" name="setMixPass" placeholder="password">
  <button id="joinMix">Join Mix</button>
  <button id="createMix">Create Mix</button>
  <button id="viewMixUsers">View Current Mix Users</button>

  <hr />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
  <script>
    /**
     * Connect to the instance of Socket.IO running on my computer.
     * Must specify the custom path, "/mix" or it won't work.
     */
    const rt = io('http://vnx.local:3000', {
      path: '/mix'
    });

    /**
     * Initialize the local variable for the room/match name.
     */
    let currentMix = "";
    let mixPass = "";

    // This is for debugging
    let serverMsg = document.getElementById("serverMsg");

    /**
     * Event Listener for "on successful connection"
     * We need to make sure we have connected to the server successfully
     * before attempting to listen for events.
     */
    rt.on('connect', (socket) => {
      serverMsg.innerText = `Connected. Your User ID is ${ rt.id }.`;
    });

    /**
     * joinMix button (click event)
     * finds mix name entered in input field,
     * emits an event called "join mix" to the server with the text from the
     * input field, and updating the interface to show that you have
     * connected to the new mix.
     */
     document.getElementById("joinMix").onclick = () => {
       currentMix = document.getElementById("setMixName").value || "HelloWorld";
       mixPass = document.getElementById("setMixPass").value;
       let req = {
         "name": currentMix,
         "password": mixPass
       };

       rt.emit("join mix", req, (res) => {
         if (res.code === 200) {
           document.getElementById("mixName").innerText = `Current Mix: ${ currentMix }`;
         } else {
           document.getElementById("mixName").innerText = `Failed to join ${ currentMix }`;
         }
       });
     }

     /**
      * createMix (click event)
      * @type {[type]}
      */
     document.getElementById("createMix").onclick = () => {
       currentMix = document.getElementById("setMixName").value || "HelloWorld";
       mixPass = document.getElementById("setMixPass").value;
       let req = {
         "newMix": true,
         "name": currentMix,
         "password": mixPass
       };

       rt.emit("join mix", req, (res) => {
         if (res.code === 200) {
           document.getElementById("mixName").innerText = `Current Mix: ${ currentMix }`;
         } else {
           document.getElementById("mixName").innerText = `Failed to join ${ currentMix }`;
         }
       });
     }

    /**
     * viewMixUsers button (click event)
     * on click, an event is emitted to the
     * server called "view mix users" with the mixtape name. We expect the
     * server to respond with an array of users who are connected to the mix.
     */
    document.getElementById("viewMixUsers").onclick = () => {
      rt.emit("view mix users", currentMix, (res) => {
        document.getElementById("userList").innerText = `Users Connected: ${ res }`;
      });
    }

  </script>
</body>
</html>
