<!DOCTYPE html>
<html>
<!--
  Created by Kyle Permuy, 9/8/2017
-->
<head>
  <title>Server Unit Tests</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    border: 0;
    display: block;
  }
  small {
    margin-top: -10px;
    display: block;
    padding-bottom: 15px;
  }
  div {
    border-top: 1px solid black;
    padding: 2px 0;
    margin-bottom: 10px;
  }
  .complete, .complete:visited {
    color: #00ee00;
  }
  .incomplete, .incomplete:visited {
    color: #ee0000;
  }
  #sidebar {
    width: 18%;
    display: inline-block;
    position: fixed;
    height: 100%;
    vertical-align: top;
    border: 1px solid black;
  }
  #sidebar a {
    display: block;
    margin: 25px 10px;
  }
  #content {
    width: 80%;
    display: inline-block;
    margin-left: 20%;
    height: 100%;
    vertical-align: top;
  }
</style>
</head>

<body>
  <div id="sidebar">
    <a class="incomplete" href="#userSection">User Settings</a>
    <a class="complete" href="#mixSection">Mix Settings</a>
    <a class="incomplete" href="#searchSection">Search Songs</a>
    <a class="incomplete" href="#tapeSection">Current Mixtape</a>
    <a class="incomplete" href="#savedSection">Saved Songs</a>
  </div>
  <div id="content">
    <h1>SpeakerShare Server Unit Tests</h1>
    <div id="userSection">
      <h3 >User Settings</h3>
      <small>View your Client ID and attach your connection to a Facebook account.</small>

      <p id="serverMsg">Connecting to server...</p>
      <button id="connectFB">Connect via Facebook</button>

      <br /><br />
      <p id="userObjectMsg">User Object...</p>
      <input type="text" id="sendUserObject" name="sendUserObject">
      <button id="sendUserObjectButton">send user</button>
    </div>

    <div id="mixSection">
      <h3 >Mix Settings</h3>
      <small>Connect to a Mix or join your own.</small>

      <p id="mixName">Not connected to a mix.</p>
      <p id="userList">Users Connected: ...</p>
      <input type="text" id="setMixName" name="setMixName" placeholder="HelloWorld">
      <input type="text" id="setMixPass" name="setMixPass" placeholder="pass">
      <button id="joinMix">Join Mix</button>
      <button id="createMix">Create Mix</button>
      <button id="viewMixUsers">View Current Mix Users</button>
    </div>

    <div id="searchSection">
      <h3 >Search Songs</h3>
      <small>Enter a search term into the input box, select the service you want to search (for now), and the results should appear in a paginated list.</small>

      <input type="text" id="searchBox" name="searchBox" placeholder="Search">
      <button id="spotify">Search Spotify</button>
      <button id="soundcloud">Search Soundcloud</button>

      <ul id="searchResults">
        <li>(results here; limit 10 results per page)</li>
      </ul>

      <button id="">Back</button>
      <button id="">Next</button>
    </div>

    <div id="tapeSection">
      <h3 >Current Mixtape</h3>
      <small>Listed here are all the songs either you or others have added to the mixtape you are currently in.</small>

      <input type="text" id="" name="" placeholder="Spotify:URI or Soundcloud">
      <button id="">Add Song to Mixtape</button>

      <ul id="mixtape">
        <li>(list songs here)</li>
      </ul>
    </div>

    <div id="savedSection">
      <h3 >Saved Songs</h3>
      <small>If you like a song, you can choose to save it for later use.</small>

      <ul>
        <li>(list songs here)</li>
      </ul>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
  <script>
    /**
     * Connect to the instance of Socket.IO running on my computer.
     * Must specify the custom path, "/mix" or it won't work.
     */
    const rt = io('http://localhost:3000');

    /* , {
      path: '/mix'
    } */
    /**
     * Initialize the local variable for the room/match name.
     */
    let currentMix = "";
    let mixPass = "";

    // This is for debugging
    let serverMsg = document.getElementById("serverMsg");

    /**
     * Event Listener for "on successful connection"
     * We need to make sure we have connected to the server successfully
     * before attempting to listen for events.
     */
    rt.on('connect', (socket) => {
      serverMsg.innerText = `Connected. Your User ID is ${ rt.id }.`;

      /**
       * [onclick description]
       * @type {[type]}
       */
      document.getElementById("sendUserObjectButton").onclick = () => {
        console.log("Fuck");
        let userObject = document.getElementById("sendUserObject").value;
        console.log(userObject);
        rt.emit("authenticate", userObject, (cb) => {
          console.log("Auth emit running.");
          console.log(cb);
          document.getElementById("userObjectMsg").innerText = cb;
          if (cb.status == true) {
            console.log("Success! Authenticated!");
          }
        });
      }

      /**
       * joinMix button (click event)
       * finds mix name entered in input field,
       * emits an event called "join mix" to the server with the text from the
       * input field, and updating the interface to show that you have
       * connected to the new mix.
       */
       document.getElementById("joinMix").onclick = () => {
         currentMix = document.getElementById("setMixName").value || "HelloWorld";
         mixPass = document.getElementById("setMixPass").value;
         let req = {
           "name": currentMix,
           "pass": mixPass
         };

         console.log("joining mix");
         
         rt.emit("join mix", req, (res) => {
           
           console.log("joining");
           console.log(res);
           if (res.status == true) {
             document.getElementById("mixName").innerText = `Current Mix: ${ currentMix }`;
           } else {
             document.getElementById("mixName").innerText = `Failed to join ${ currentMix }`;
           }
         });
       }

       /**
        * createMix (click event)
        * @type {[type]}
        */
       document.getElementById("createMix").onclick = () => {
         currentMix = document.getElementById("setMixName").value || "HelloWorld";
         mixPass = document.getElementById("setMixPass").value;
         let req = {
           "name": currentMix,
           "pass": mixPass,
           "mongo_id": '59c70e99964ec3f974199594',
         };

         rt.emit("create mix", req, (res) => {
           console.log(res);
           if (res === true) {
             document.getElementById("mixName").innerText = `Current Mix: ${ currentMix }`;
           } else {
             document.getElementById("mixName").innerText = `Failed to join ${ currentMix }`;
           }
         });
       }

      /**
       * viewMixUsers button (click event)
       * on click, an event is emitted to the
       * server called "view mix users" with the mixtape name. We expect the
       * server to respond with an array of users who are connected to the mix.
       */
      document.getElementById("viewMixUsers").onclick = () => {
        rt.emit("view mix users", currentMix, (res) => {
          document.getElementById("userList").innerText = `Users Connected: ${ res }`;
        });
      }







    });

  </script>
</body>
</html>
